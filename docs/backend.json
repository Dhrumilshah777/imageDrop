{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the ImageDrop application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user entity."
        },
        "googleId": {
          "type": "string",
          "description": "The unique identifier provided by Google for the user."
        },
        "email": {
          "type": "string",
          "description": "The email address of the user.",
          "format": "email"
        },
        "displayName": {
          "type": "string",
          "description": "The display name of the user."
        },
        "profileImageUrl": {
          "type": "string",
          "description": "URL of the user's profile image.",
          "format": "uri"
        }
      },
      "required": [
        "id",
        "googleId",
        "email",
        "displayName",
        "profileImageUrl"
      ]
    },
    "Image": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Image",
      "type": "object",
      "description": "Represents an image uploaded by a user.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the image entity."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N Image)"
        },
        "imageUrl": {
          "type": "string",
          "description": "URL of the uploaded image.",
          "format": "uri"
        },
        "uploadDate": {
          "type": "string",
          "description": "Date and time when the image was uploaded.",
          "format": "date-time"
        },
        "description": {
          "type": "string",
          "description": "Optional description of the image."
        }
      },
      "required": [
        "id",
        "userId",
        "imageUrl",
        "uploadDate"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous",
      "google.com"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profile information. The userId is the Firebase Authentication UID.",
          "params": [
            {
              "name": "userId",
              "description": "The Firebase Authentication UID of the user."
            }
          ]
        }
      },
      {
        "path": "users/{userId}/images/{imageId}",
        "definition": {
          "entityName": "Image",
          "schema": {
            "$ref": "#/backend/entities/Image"
          },
          "description": "Stores images uploaded by a specific user. Path-based ownership ensures only the user can access their images.",
          "params": [
            {
              "name": "userId",
              "description": "The Firebase Authentication UID of the user who owns the image."
            },
            {
              "name": "imageId",
              "description": "The unique ID of the image."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to store user and image data for the ImageDrop application. It prioritizes security, scalability, and ease of debugging, adhering to the principles of Authorization Independence and Structural Segregation. The structure uses path-based ownership for user data and their associated images. This eliminates the need for `get()` calls in security rules, simplifying the rule logic and ensuring atomic operations. The structure enables secure `list` operations by storing each user's images in a dedicated subcollection, thus satisfying the QAPs principle."
  }
}